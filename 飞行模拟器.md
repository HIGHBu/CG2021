# 飞机模拟器

小组成员 董乙灿 高晨熙 夏霄汉

## 游戏介绍

本游戏是一款飞机模拟器游戏，玩家通过键盘操纵一架飞机从起飞到降落全过程，目标是还原飞机实际飞行的状态，最终安全到达目的地并尽可能获得更高的分数。在飞机飞行过程中，会遇到各种各样的障碍，玩家需要操控飞机安全躲避这些障碍，若飞机撞击到障碍物则会坠毁。在飞行过程中也会有许多补给包，玩家操控飞机获取补给包可以加分。除了最基本的飞行设计之外，玩家还可以发射子弹攻击沿途设置的目标，以获得更高的分数。在飞行过程中，可能会遇到各式各样的天气状况，影响飞行视线。当夜幕降临时，请谨慎驾驶。

## 基本功能

### 起飞降落

起飞降落过程为CG动画，玩家可通过拖动鼠标各角度观看欣赏

#### 起飞

设置键盘交互功能，按下F键后，飞机自动由飞机场经过一段滑行后逐渐起飞，升入空中，恢复玩家自由控制

#### 降落

设置键盘交互功能，按下G键后，停止玩家自由控制，飞机自动下降高度，经过飞机场的一段滑行后缓缓停下

### 飞行

在飞行过程中，玩家可通过键盘交互功能，自由地操作飞机的行进，包括前进、上升、下降、加速、减速、转弯和旋转机身等

#### 前进

在不使用键盘对飞机进行任何操作的情况下，飞机将自动匀速向前飞行

#### 上升

设置键盘交互功能，按下`J`键时，飞机机头抬高，飞机高度上升；放开`J`键后，飞机机头恢复水平

#### 下降

设置键盘交互功能，按下`K`键时，飞机机头放低，飞机高度下降；放开`K`键后，飞机机头恢复水平

#### 加速

设置键盘交互功能，按下`W`键后，飞机飞行速度加快，在加速的同时飞机两侧会有气流效果

#### 减速

设置键盘交互功能，按下`S`键后，飞机飞行速度减慢，在减速的同时飞机两侧会有反向气流效果

#### 转弯

设置键盘交互功能，按下`A`键时，飞机向左侧飞行；按下`D`键时，飞机向右侧飞行

#### 旋转

设置键盘交互功能，按下`Q`键时，飞机逆时针旋转机身；按下`E`键时，飞机顺时针旋转机身

### 光线和阴影

设置光源为飞行方向正前方偏上位置，飞机模型和障碍物上会有一些阴影效果

在飞机的飞行过程中，地面上有飞机的影子跟随飞机同步移动

### 视角切换

设置鼠标交互功能，通过拖动鼠标，可以以飞机中心为原点，改变观察视角

### 地形

在起飞和降落阶段的地点位于平坦的飞机场，设置起飞跑道和两侧的房子、树等环境，在起飞（降落）的过程中，环境背景从大变小（从小变大）、从清晰变模糊（从模糊变清晰）

在飞行途中需避开前方的山体、楼房等障碍物，如果撞到障碍物，飞机将坠毁，产生爆炸效果

### 得分

在飞机飞行的路线上将随机产生补给包，操纵飞机触碰补给包可获得额外加分

## 特殊功能

### 时间和天气系统

飞行过程有时间模拟系统，随着游戏的进行会逐渐从白昼变到黑夜；另外可能会随机性地遭遇极端天气，影响正常的飞行体验

### 攻击效果

给飞机添加额外的攻击系统，在飞行沿途增加可攻击的目标，摧毁目标可以获得额外的分数

## 创新点

### WebGL

采用WebGL开发，可以更方便地在网页端游玩

### 实时碰撞检测

在飞机飞行过程中，会遇到各种各样的障碍，玩家需要操控飞机安全躲避这些障碍，若飞机被撞击则会坠毁

### 光照明模型细化

实现实时阴影功能，使飞行游戏画面具有更强的真实感

## 基本实现

### 基本体素

我们的模型基于类的继承和派生

- 顶点
  - 包含坐标、颜色、纹理坐标等
- 面
  - 包括立方体、圆柱体、网格等
  - 由顶点确定位置，由法向量确定方向

### 纹理和材质

#### 纹理

- 使用类`TextureManager`，对纹理进行载入、绑定和编辑
- `initTextures()`创建纹理并加载图片，`handleTextureLoaded()`回调函数执行纹理与模型的绑定

#### 材质

在绘制时结合光照模型计算，向着色器传递参数

### 光线和阴影

目前计划使用方向光，以此达到影子投影于地面的效果

根据每个面的法向量与光线的传播方向法向量确定光的效果

### 响应事件

- 使用键盘回调函数响应键盘事件，实现模型移动的效果
- 使用鼠标拖动函数响应鼠标拖动事件，实现观察角度的上下左右旋转
- 使用鼠标滚轮函数响应鼠标滚轮事件，实现观察区域的放大缩小